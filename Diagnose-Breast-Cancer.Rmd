---
title: "Diagnose Breast Cancer"
author: "Scott Ligon and Karen Tafolla"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Objective
We will use mammogram screenings from 280,659 women in order to predict whether the patient is in risk of breast cancer. The screenigs are from a major city from the following states: Washington, California, New Mexico, Souch Calorina, New Hampshire, Vermont, and Illinois.

## Information About Data Set

Each mammogram screening includes the following features:
  
  + Menopause: To tell whether a patient has gone through menopause.
  + Age Group: Patient age ranging from 35-84.
  + Breast Density: Density of a patient's breast.
  + Race: Category of patients' race.
  + Hispanic: Classification if a patient is Hispanic.  0-not hispanic 1-hispanic
  + Body Mass Index: Patient's body mass.
  + Age of First Birth: Age of a patient's first child birth.
  + Relatives with Breast Cancer: History if patient has relatives with breast cancer.
  + Breast Procedure: Records of if a patient has had a prior breast procedure.
  + Last Mammogram Result: Results of the last mammogram before the index mammogram.
  + Surgical Menopause: To tell if a woman has gone through a surgical menopause.
  + Hormone Therapy: To tell if a woman has gone through hromone therapy.
  + Invasive breast cancer: Diagnosis if invasive breast cancer has been found within a year of index screening mammogram.
  + Cancer: Diagnosis of invasive or ductal carcinoma within a year of index screening mammogram. 0-no cancer 1-cancer.
  + Training: Training data from dataset.
  + Count: Frequency count of combination of all prior features and their outcomes.

Data for this study was obtained from the BCSC Data Resource. More information regarding this resource is available at: http://breastscreening.cancer.gov/.

## Hypothesis

Based on the information listed above we believe that age group, menopause, breast density, relatives with breast cancer, and invasive breast cancer within the past year will be the most influential features to help determine whether a patient has breast cancer or not. 

## Dependencies

These are dependencies needed in case we want to split data, make classification trees, and work with Naive Bayes classifier.
```{r}
library(rpart)
library(rpart.plot)
library(maptree)
library(e1071)
source("lin-regr-util.R")
source("class-util.R")
```

## Gathering and Processing Data

We modified the feature names in order to have more meaninful names rather than acronyms that might be hard to understand. We also switched some of the numeric values into factors in order for the data to be easier to understand and process. With this dataset we are making the assumption of labeling items with the second name rather than the first name when the row of the feature is labeled unknown. For example, under the surgical menopause the original label for a number nine is "unknown or not menopausal". For this feature and others like it we will change the label to not menopausal or the corresponding second label.
```{r}
mammogram = read.csv("risk.csv")
names(mammogram) <- c("menopause","age.group","breast.density","race","hispanic","bmi","age.first.birth","relatives.with.bc","breast.procedure","last.mammogram","surgical.menopause","hormone.therapy","invasive.bc","cancer","training","count")

# Converting from numbers to factors
mammogram$age.group = factor(mammogram$age.group, levels = c(1,2,3,4,5,6,7,8,9,10), labels = c("35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "65-69", "70-74", "75-79", "80-84"))

mammogram$race = factor(mammogram$race, levels = c(1,2,3,4,5,9), labels = c("white", "Asian/Pacific Islander","black", "Native American", "other/mixed", "unknown"))

mammogram$bmi = factor(mammogram$bmi, levels = c(1,2,3,4,9), labels = c("10-24.99", "25-29.99", "30-34.99", "35 or more","unknown"))

mammogram$breast.density = factor(mammogram$breast.density, levels = c(1,2,3,4,9), labels = c("fat","scattered", "dense", "extremely dense", "different measurement"))

mammogram$surgical.menopause = factor(mammogram$surgical.menopause, levels = c(0,1,9), labels = c("natural", "surgical","not menopausal"))

mammogram$hormone.therapy = factor(mammogram$hormone.therapy, levels = c(0,1,9), labels = c("no", "yes","not menopausal"))

mammogram$age.first.birth = factor(mammogram$age.first.birth, levels = c(0,1,2,9), labels = c("< 30", ">= 30","nulliparous", "unknown"))

mammogram$cancerAsFactor = factor(mammogram$cancer, levels = c(0,1), labels = c("no cancer", "cancer"))
```

Below we are looking at all the values where there is unknown data or anything label as a 9 which is also unknown data. After looking at the summay of the data we realized that 109179 rows out of the total 280659 had unknown information when it came to the body mass index (bim). Since the number of missing data was almost 40 percent of the whole data we decided to to completely remove the bim feature. Aside from removing the bmi feature we will remove the count and training features because they do not provide relevant information to our model. The training feature only states where to split the data, we will not follow this since we want our data to be split randomdly. As for the count, it was removed because it's previous combinations of all features and outcomes something that is not necessary for this project.
```{r}
paste("Total Number of rows:", nrow(mammogram))
paste("Patients without Cancer:", sum(mammogram$cancer==0))
paste("Patients with Cancer:", sum(mammogram$cancer==1))

paste("Menopause:", sum(mammogram$menopause == 9))
paste("Race:", sum(mammogram$race == "unknown"))
paste("BMI", sum(mammogram$bmi == "unknown"))
paste("Age of First Birth:", sum(mammogram$age.first.birth == 9))
paste("Relatives with Breast Cancer:", sum(mammogram$relatives.with.bc == 9))
paste("Hispanic:", sum(mammogram$hispanic == 9))
paste("Last Mammogram:", sum(mammogram$last.mammogram == 9))
paste("Breast Procedure:", sum(mammogram$breast.procedure == 9))

mammogram$training = NULL
mammogram$count = NULL
mammogram$bmi = NULL

```

Even after removing a feature there are still a lot of uncertainty in between the data sets so we will remove all uncertainty from the dataset. We will do this by removing the rows of those items that have unknown data for menapause, race, age of first birth, relatives with breast cancer, whether their hispanic, last mammograrm, and breast procedure. 
```{r}
rows = mammogram$hispanic == 9
mammogram = mammogram[!rows, ]

rows = mammogram$age.first.birth == 9
mammogram = mammogram[!rows, ]

rows = mammogram$relatives.with.bc == 9
mammogram = mammogram[!rows, ]

rows = mammogram$menopause == 9
mammogram = mammogram[!rows, ]

rows = mammogram$last.mammogram == 9
mammogram = mammogram[!rows, ]

rows = mammogram$breast.procedure == 9
mammogram = mammogram[!rows, ]

rows = mammogram$race == "unknown"
mammogram = mammogram[!rows, ]

sum(mammogram$menopause == 9)
sum(mammogram$race == "unknown")
sum(mammogram$age.first.birth == 9)
sum(mammogram$relatives.with.bc == 9)
sum(mammogram$hispanic == 9)
sum(mammogram$last.mammogram == 9)
sum(mammogram$breast.procedure == 9)
```

After removing all the the uncertainty from our dataset our dataset goes from containing 280659 rows to 60895 rows meaning we lost about 78 percent of all our data. We also went from our initial 16 features we came down to 13 unique features, the 14th feature shown in below is the cancer label but in the format of a factor. 
```{r}
str(mammogram)
```

## Data Exploration

For the data exploration we will only use barplots and density plots because majority of our data is in the form of factors and it rather difficult to try to use any other type of plot when exploring the data.

Based on the summary we can see that most of the patients getting a mammogram screening are between 50 to 54. 
```{r}
summary(mammogram)
```

From all the data that is remaning we can see that majority of the patients do not have cancer. We can see that only about four percent of the data is relevant to patients that do have cancer. This information will be crutial when it comes to predicting because we would rather have patients think that they have cancer and do all the procedures to prevent cancer rather than having a patient think they do not have cancer and later go through health problems.  
```{r}
paste("Patients without Cancer:", sum(mammogram$cancer==0))
paste("Patients with Cancer:", sum(mammogram$cancer==1))
```


```{r}
plot(density(mammogram$hispanic), col="firebrick", main = "Density of Patients with Hispanic decent")
```

```{r}
par(mar=c(5, 10, 4, 2))
plot(mammogram$race, col="salmon", main="Race of Patients", horiz = TRUE, las=1)
```


From this graph we can see that majority of the patients have not had invasive breast cancer in the past. As for getting any form of breast procedure we can see that about 30,000 patients have had a breast procedure in the past. 
```{r}
# count number of yes and no of each table
Invasive.BC = table(mammogram$invasive.bc)
Breast.Procedure = table(mammogram$breast.procedure)

# plot both items side by side in same graph
barplot(cbind(Invasive.BC, Breast.Procedure), main="Patients that have had Invasive Breast Cancer or a Breast Procedure", beside=TRUE, col=c("lightblue", "salmon"), las=1)
ticks<-c(10000,30000,50000,70000)
axis(2,at=ticks,labels=ticks, las=1)
legend("topright", c("NO", "YES"), inset=0.05, fill=c("lightblue", "salmon"))
```

From this horizontal barplot we can see that some of the data might not be helpful when predicting because some of the breast density was measured differently and it does not provide helpful insight.
```{r}
par(mar=c(5, 10, 4, 2))
plot(mammogram$breast.density, col="salmon", main="Breast Density", horiz = TRUE, las=1)
```


From these two plots we can see that majority of the patients from the data do not have cancer. For those individuals that do have breast cancer the age range that seems to be more prone to breast cancer is from 50 to 74 years of age. 
```{r}
# have two graphs side by side
par(mfrow=c(1,2))

# range to use for the x limit
range = sort(as.vector(table(mammogram$age.group[mammogram$cancer == 0])), decreasing = TRUE)[1]

# plot patients with cancer
barplot(table(mammogram$age.group[mammogram$cancer == 1]), main = "Patient Age Group with Cancer", col="salmon", xlim=c(1, range), horiz = TRUE,las=1)

# plot patients without cancer
barplot(table(mammogram$age.group[mammogram$cancer == 0]), main = "Patient Age Group with No Cancer", col="light blue", xlim =c(1, range), horiz = TRUE,las=1)
```

```{r}
plot(mammogram$hormone.therapy, col="salmon", main="The number of patients going through Hormone Treatment")
```

## Splitting data into training and testing datasets

In order to continue our work on predicting whether a patient has breast cancer or not we will split the data into to testing and training dataset. That way we can train or models and test our results.
```{r}
set.seed(132)
split = split_data(mammogram)
tr_dat = split[[1]]
te_dat = split[[2]]
```

## Creating Naive Bayes Classification 

The Naive Bayes model will include the features age group, menopause, breast density, relatives with breast cancer, and invasive breast cancer. 
```{r}
fit1 = naiveBayes(cancerAsFactor ~ age.group + menopause + breast.density + relatives.with.bc + invasive.bc, data = tr_dat)

class(fit1)
summary(fit1)
print(fit1)
```

```{r}
actual = te_dat$cancerAsFactor
predicted = predict(fit1, newdata = te_dat)

con_matrix = table(actual, predicted)
con_matrix
```

Although typically with Naive Bayes incrementing the number of 


## Logistic Regression

## Classification Trees

fit = pre

## Naive Bayes
